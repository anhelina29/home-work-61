# Express Server –∑ MongoDB —Ç–∞ Passport.js

–¶–µ REST API —Å–µ—Ä–≤–µ—Ä, –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ Node.js —Ç–∞ Express.js –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é MongoDB (—á–µ—Ä–µ–∑ Mongoose) –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö. –ü—Ä–æ—î–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Passport.js –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ —Å–µ—Å—ñ—ó –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞–Ω–æ–º –≤—Ö–æ–¥—É.

## üìã –ó–º—ñ—Å—Ç

- [–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó](#—Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó)
- [–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å](#—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è)
- [–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö](#–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è-–±–∞–∑–∏-–¥–∞–Ω–∏—Ö)
- [–ó–∞–ø—É—Å–∫](#–∑–∞–ø—É—Å–∫)
- [API –ú–∞—Ä—à—Ä—É—Ç–∏](#api-–º–∞—Ä—à—Ä—É—Ç–∏)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ—î–∫—Ç—É)

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- **Node.js** - —Å–µ—Ä–≤–µ—Ä–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
- **Express.js** v5.x - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **MongoDB & Mongoose** - –±–∞–∑–∞ –¥–∞–Ω–∏—Ö —Ç–∞ ODM
- **Passport.js** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è (Local Strategy)
- **express-session** - —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏
- **PUG & EJS** - —à–∞–±–ª–æ–Ω—ñ–∑–∞—Ç–æ—Ä–∏ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É

## ‚ú® –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å

- **MongoDB –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è**: –ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MongoDB Atlas.
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è**: –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è, –ª–æ–≥—ñ–Ω, –ª–æ–≥–∞—É—Ç –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Passport.js —Ç–∞ —Å–µ—Å—ñ–π.
- **–ó–∞—Ö–∏—â–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏**: Middleware –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∞–∫—Ç–∏–≤–Ω—É —Å–µ—Å—ñ—é (`req.isAuthenticated()`).
- **CRUD –û–ø–µ—Ä–∞—Ü—ñ—ó**: –ü–æ–≤–Ω—ñ CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–ª—è –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –ü—Ä–æ–¥—É–∫—Ç—ñ–≤ —Ç–∞ –ó–∞–º–æ–≤–ª–µ–Ω—å.
- **Server-Side Rendering**: –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ —Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω—å —á–µ—Ä–µ–∑ `pug` —Ç–∞ `ejs`.
- **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–µ–º–∏**: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è cookies –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Ç–µ–º–∏.

## üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

1. **–ö–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π**
```bash
git clone <repository-url>
cd home-work-61
```

2. **–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ**
```bash
npm install
```

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` —É –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ—î–∫—Ç—É —Ç–∞ –¥–æ–¥–∞–π—Ç–µ —Ä—è–¥–æ–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MongoDB Atlas —Ç–∞ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á –¥–ª—è JWT (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è) –∞–±–æ —Å–µ—Å—ñ–π:

```env
DB_URL=mongodb+srv://<username>:<password>@cluster0.example.mongodb.net/myDatabase
JWT_SECRET=your_secret_key_here
```

## üöÄ –ó–∞–ø—É—Å–∫

### –†–µ–∂–∏–º —Ä–æ–∑—Ä–æ–±–∫–∏
```bash
npm run dev
```

### –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º
```bash
npm start
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –Ω–∞ **http://localhost:3001**

## üì° API –ú–∞—Ä—à—Ä—É—Ç–∏

### üë• Users (`/api/users`)
- `GET /` - –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (JSON)
- `GET /render` - HTML —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (PUG)
- `POST /sign-up` - –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
- `POST /login` - –í—Ö—ñ–¥ (Passport)
- `POST /logout` - –í–∏—Ö—ñ–¥

### üõç Products (`/api/products`)
- `GET /` - –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (JSON) + –ü—Ä–æ–µ–∫—Ü—ñ—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–æ–≤–µ—Ä—Ç–∞—î —Ç—ñ–ª—å–∫–∏ —Ü—ñ–Ω—É > 150)
- `GET /render` - HTML —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (EJS)
- `POST /` - –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç
- `POST /many` - –°—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–≥–∞—Ç–æ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (`insertMany`)
- `PUT /many` - –û–Ω–æ–≤–∏—Ç–∏ –±–∞–≥–∞—Ç–æ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (`updateMany`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—è —Ç–æ–≤–∞—Ä—ñ–≤ –±–µ–∑ –∑–∞–ª–∏—à–∫—É)
- `PUT /:id` - –û–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç (Partial Update)
- `DELETE /many` - –í–∏–¥–∞–ª–∏—Ç–∏ –±–∞–≥–∞—Ç–æ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (`deleteMany`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö)
- `DELETE /:id` - –í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç

### üì¶ Orders (`/api/orders`)
- `GET /` - –°–ø–∏—Å–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å (JSON) –∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é (Cursor-based approach). –ü–∞—Ä–∞–º–µ—Ç—Ä–∏: `?page=1&limit=100`.
- `GET /data/:userId` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (Aggregation Pipeline: match, group, project, lookup, unwind).
- `GET /render` - HTML —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω—å (EJS)
- `POST /` - –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- `POST /many` - –°—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–≥–∞—Ç–æ –∑–∞–º–æ–≤–ª–µ–Ω—å (`insertMany`)
- `PUT /many` - –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –±–∞–≥–∞—Ç—å–æ—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å (`updateMany`)
- `PUT /:id` - –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- `DELETE /many` - –í–∏–¥–∞–ª–∏—Ç–∏ —Å–∫–∞—Å–æ–≤–∞–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (`deleteMany`)
- `DELETE /:id` - –í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```
home-work-61/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ users/             # –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ (Routes, Ctrl)
‚îÇ   ‚îú‚îÄ‚îÄ products/          # –ü—Ä–æ–¥—É–∫—Ç–∏ (Routes, Ctrl, Valid)
‚îÇ   ‚îú‚îÄ‚îÄ orders/            # –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è (Routes, Ctrl)
‚îÇ   ‚îî‚îÄ‚îÄ common/            # Middleware (Auth, Theme)
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ db.js              # –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MongoDB
‚îÇ   ‚îî‚îÄ‚îÄ passport.js        # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Passport Strategy
‚îú‚îÄ‚îÄ models/                # Mongoose —Å—Ö–µ–º–∏ (Users, Products, Orders)
‚îú‚îÄ‚îÄ views/                 # –®–∞–±–ª–æ–Ω–∏ (PUG, EJS)
‚îú‚îÄ‚îÄ public/                # –°—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏ (CSS)
‚îî‚îÄ‚îÄ server.js              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É
```

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä
–ü—Ä–æ—î–∫—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ —è–∫ –¥–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è –∫—É—Ä—Å—É Hillel.
